<div class="mss-view-container">
  <div class="mss-header-row">
    <div class="mss-title" *ngIf="mode !== ComponentMode.Create">{{'campaigns.detail.title' | translate}} - {{campaignName}}</div>
    <div class="mss-title" *ngIf="mode === ComponentMode.Create">{{'campaigns.list.addCampaign' | translate}}</div>
    <div class="mss-buttons-row" *ngIf="mode !== ComponentMode.Create">
      <mss-button class="mss-action-button right-margin" *ngIf="campaignDetail"
                  [label]="campaignDetail.running ?  ('basic.deactivate' | translate) : ('basic.activate' | translate)"
                  (click)="toggleCampaign()"></mss-button>
      <mss-button class="mss-action-button" (click)="modalVisible = true"
                  [label]="'campaigns.detail.deleteCampaign' | translate"></mss-button>
    </div>
  </div>

  <form [formGroup]="campaignForm" (ngSubmit)="handleCampaignSubmit()" *ngIf="mode === ComponentMode.Create || campaignDetail">
    <div class="content">
      <div class="column">
        <mss-input *ngIf="mode !== ComponentMode.View" class="item" [label]="'basic.name' | translate" formControlName="name"></mss-input>
        <div *ngIf="mode === ComponentMode.View" class="mss-input-like-container item">
          <div class="label">{{'basic.name' | translate}}</div>
          <div class="value">{{campaignDetail.name}}</div>
        </div>
        <mss-select *ngIf="mode !== ComponentMode.View" class="item" [options]="campaignFactories"
                    [label]="'campaigns.dictionary.campaignName' | translate"
                    formControlName="campaignName"></mss-select>
        <div *ngIf="mode === ComponentMode.View" class="mss-input-like-container item">
          <div class="label">{{'campaigns.dictionary.campaignName' | translate}}</div>
          <div class="value">{{campaignDetail.campaignName}}</div>
        </div>
      </div>
      <div class="column">
        <mss-input *ngIf="mode !== ComponentMode.View" class="item" type="number" formControlName="orderCampaign"
                   [label]="'campaigns.dictionary.orderCampaign' | translate"></mss-input>
        <div *ngIf="mode === ComponentMode.View" class="mss-input-like-container item">
          <div class="label">{{'campaigns.dictionary.orderCampaign' | translate}}</div>
          <div class="value">{{campaignDetail.orderCampaign}}</div>
        </div>
        <mss-toggle *ngIf="mode !== ComponentMode.View" [label]="'campaigns.dictionary.runAfterStart' | translate"
                    formControlName="runAfterStart"></mss-toggle>
        <div *ngIf="mode === ComponentMode.View" class="mss-input-like-container item">
          <div class="label">{{'campaigns.dictionary.runAfterStart' | translate}}</div>
          <div class="value">{{campaignDetail.runAfterStart ? ('basic.yes' | translate) : ('basic.no' | translate)}}</div>
        </div>
      </div>
    </div>
    <div class="mss-buttons-row">
      <mss-button [label]="'basic.edit' | translate" *ngIf="mode === ComponentMode.View" type="button" (click)="startEditing()"
                  class="mss-action-button"></mss-button>
      <mss-button [label]="'basic.dismiss' | translate" *ngIf="mode === ComponentMode.Edit" type="button"
                  (click)="cancelEditing()" class="mss-action-button right-margin"></mss-button>
      <mss-button [label]="'basic.dismiss' | translate" *ngIf="mode === ComponentMode.Create" type="button"
                  (click)="goToList()" class="mss-action-button right-margin"></mss-button>
      <mss-button [label]="'basic.save' | translate" *ngIf="mode === ComponentMode.Edit" type="submit" [disabled]="campaignForm.invalid"
                  class="mss-action-button"></mss-button>
      <mss-button [label]="'basic.add' | translate" *ngIf="mode === ComponentMode.Create" type="submit" [disabled]="campaignForm.invalid"
                  class="mss-action-button"></mss-button>
    </div>
  </form>

  <div class="properties" *ngIf="mode !== ComponentMode.Create">
    <div class="mss-header-row">
      <div class="mss-title">{{'campaigns.detail.properties' | translate}}</div>
      <mss-button class="mss-action-button" (click)="toggleProperties()"
                  [label]="editingProperties ? ('basic.preview' | translate) : ('basic.edit' | translate)"></mss-button>
    </div>
    <div class="content" *ngIf="!editingProperties">
      <div class="column " *ngIf="properties.length === 0">{{'campaigns.detail.noProperty' | translate}}
      </div>
      <div class="column" *ngIf="properties.length > 0">
        <div class="mss-input-like-container item" *ngFor="let property of properties">
          <div class="label">{{property.pk.key}}</div>
          <div class="value">{{property.value}}</div>
        </div>
      </div>
      <div class="column"></div>
    </div>
    <form *ngIf="editingProperties && propertyForm" [formGroup]="propertyForm" (ngSubmit)="updateProperties()">
      <div class="content">
        <div class="column" *ngIf="propertyForm.value.length === 0">
          {{'campaigns.detail.noDefaultProperty' | translate}}
        </div>
        <div class="column" *ngIf="propertyForm.value.length > 0">
          <div *ngFor="let property of propertyForm.value; let i = index; trackBy: identifyProperty" [formGroupName]="i" class="item">
            <mss-input *ngIf="property.type === 'STRING'" [placeholder]="property.placeholder"
                       [label]="property.key + (property.required ? '*' : '')" formControlName="value"></mss-input>
            <mss-input *ngIf="property.type === 'NUMBER'" [placeholder]="property.placeholder" [type]="number"
                       [label]="property.key + (property.required ? '*' : '')" formControlName="value"></mss-input>
            <mss-toggle *ngIf="property.type === 'BOOLEAN'" [label]="property.key + (property.required ? '*' : '')"
                        formControlName="value"></mss-toggle>
            <mss-select *ngIf="property.data" [showName]="property.placeholder" [label]="property.key + (property.required ? '*' : '')"
                        formControlName="value" [options]="property.data"></mss-select>
          </div>
        </div>
        <div class="column"></div>
      </div>
      <div class="button-container">
        <mss-button *ngIf="propertyForm.value.length > 0" [disabled]="propertyForm.invalid" class="mss-action-button"
                    [label]="'basic.save' | translate"></mss-button>
      </div>
    </form>
  </div>
</div>

<mss-modal-window [(visible)]="modalVisible">
  <h3 class="mss-modal-title">
    {{'campaigns.list.deleteQuestion' | translate}}
  </h3>
  <div class="button-container">
    <mss-button class="mss-action-button right-margin" [label]="'basic.dismiss' | translate" (click)="modalVisible = false"></mss-button>
    <mss-button class="mss-action-button" [label]="'basic.yes' | translate" (click)="deleteCampaign()"></mss-button>
  </div>
</mss-modal-window>
