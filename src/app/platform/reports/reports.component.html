<div class="mss-view-container">
  <div class="mss-header-row">
    <span class="mss-title">{{'reports.list.title' | translate}}</span>
  </div>

  <div class="row">
    <div class="column" [formGroup]="filterForm">
      <mss-tabs class="tabs" *ngIf="filterSections.length > 1" [items]="filterSections" (itemChanged)="visibleSection = $event"></mss-tabs>
      <div class="content column" *ngIf="visibleSection.value ===  reportFilterSection.BASIC">
        <div class="row wrapped">
          <mss-input class="mss-filter-item" formControlName="reportName" [label]="'basic.name' | translate"></mss-input>
          <mss-select class="mss-filter-item" formControlName="type" [options]="reportTypes"
                      [label]="'dictionary.type' | translate" [clearAble]="true"></mss-select>
        </div>
        <div class="row wrapped">
          <div class="calendar-select mss-filter-item">
            <span class="label">{{'dictionary.from' | translate}}</span>
            <mss-date-time-picker-input class="calendar-input" formControlName="createdFrom"></mss-date-time-picker-input>
          </div>
          <div class="calendar-select mss-filter-item">
            <span class="label">{{'dictionary.to' | translate}}</span>
            <mss-date-time-picker-input class="calendar-input" formControlName="createdTo"></mss-date-time-picker-input>
          </div>
        </div>
      </div>

      <div class="content" *ngIf="visibleSection.value === reportFilterSection.ACQUIRER">
        <div class="row wrapped">
          <mss-select class="mss-filter-item" formControlName="networkCode" *mssRoleIf="'reports.networkCodeSelect'" [options]="networkCodes"
                      [clearAble]="true" [label]="'dictionary.networkCode' | translate"></mss-select>
          <mss-select class="mss-filter-item" formControlName="merchantCode" *mssRoleIf="'reports.merchantCodeSelect'" [options]="merchantCodes"
                      [clearAble]="true" [label]="'dictionary.merchantCode' | translate"></mss-select>
          <mss-select class="mss-filter-item" formControlName="orgUnitCode" *mssRoleIf="'reports.orgUnitCodeSelect'" [options]="orgUnitCodes"
                      [clearAble]="true" [label]="'dictionary.orgUnitCode' | translate"></mss-select>
        </div>
      </div>

      <div class="content" *ngIf="visibleSection.value === reportFilterSection.ISSUER">
        <div class="row wrapped">
          <mss-select class="mss-filter-item" formControlName="issuerCode" [options]="issuerCodes" [clearAble]="true"
                      *mssRoleIf="'reports.issuerCodeSelect'" [label]="'dictionary.issuerCode' | translate"></mss-select>
          <mss-select class="mss-filter-item" formControlName="cardGroupCode" [options]="cardGroupCodes" [clearAble]="true"
                      *mssRoleIf="'reports.cardGroupCodeSelect'" [label]="'dictionary.cardGroupCode' | translate"></mss-select>
        </div>
      </div>
    </div>
    <mss-button [ngClass]="{'top-margin': filterSections.length <= 1}" class="mss-action-button shifted"
                [label]="'basic.clearFilter' | translate" (click)="clearFilter()"></mss-button>
  </div>

  <div class="mss-buttons-row start">
    <mss-button class="mss-action-button" [label]="'basic.search' | translate" (click)="getReports()"></mss-button>
  </div>

  <div class="data-table-container">
    <ngx-datatable #table [loadingIndicator]="loading" [columnMode]="'force'" [rows]="rows"
                   [headerHeight]="70" [footerHeight]="50" [rowHeight]="'auto'"
                   [externalPaging]="true" [limit]="rowLimit"
                   [externalSorting]="true" (sort)="getSortedReports($event)"
                   [selectionType]="'single'"
                   [count]="totalItems " (page)="setPage($event)">
      <ngx-datatable-column [name]="'basic.id' | translate" prop="id" [width]="100"
                            *mssRoleIf="'reports.issuerPortal'" [sortable]="true"></ngx-datatable-column>
      <ngx-datatable-column [name]="'basic.name' | translate" prop="name" [sortable]="false">
        <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
          <span [title]="value" class="mss-limited-text">{{value}}</span>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'reports.dictionary.reportDataName' | translate" prop="reportDataName"
                            *mssRoleIf="'reports.reportDataName'" [sortable]="false">
        <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
          <span [title]="value" class="mss-limited-text">{{value}}</span>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.orgUnitCode' | translate" prop="orgUnitCode"
                            *mssRoleIf="'createEdit.orgUnitCodeSelect'" [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.merchantCode' | translate" prop="merchantCode"
                            *mssRoleIf="'createEdit.merchantCodeSelect'" [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.networkCode' | translate" prop="networkCode"
                            *mssRoleIf="'createEdit.networkCodeSelect'" [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.cardGroupCode' | translate" prop="cardGroupCode"
                            *mssRoleIf="'createEdit.cardGroupCodeSelect'" [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.issuerCode' | translate" prop="issuerCode"
                            *mssRoleIf="'createEdit.issuerCodeSelect'" [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'reports.dictionary.createdBy' | translate" prop="createdBy"
                            *mssRoleIf="'reports.createdBy'" [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'reports.dictionary.path' | translate" prop="path"
                            *mssRoleIf="'reports.path'" [sortable]="false">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'reports.dictionary.type' | translate" prop="type" [sortable]="false">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'reports.dictionary.download' | translate" [sortable]="false">
        <ng-template ngx-datatable-cell-template let-row="row">
          <div class="edit-buttons-container">
            <i (click)="download(row.id)" class="material-icons icon">file_download</i>
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-footer>
        <ng-template ngx-datatable-footer-template>
          <mss-table-footer
            [page]="pageNumber"
            [rowsShown]="rowLimit"
            [rowCount]="totalItems"
            (rowsShownChange)="itemsPerPage($event)"
            (changePage)="table.onFooterPage($event)"
            class="d-table-footer">
          </mss-table-footer>
        </ng-template>
      </ngx-datatable-footer>
    </ngx-datatable>
  </div>
</div>
