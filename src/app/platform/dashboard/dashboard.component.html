<div [ngClass]="{'mss-view-container': !embededObject}">
  <div class="mss-header-row" *ngIf="!embededObject">
    <span class="mss-title">{{'transactions.list.title' | translate}}</span>
  </div>

  <div class="row">
    <div class="column" [formGroup]="filterForm">
      <mss-tabs class="tabs" [items]="filterOptions" (itemChanged)="visibleFilter = $event"></mss-tabs>

      <!--DATE TAB-->
      <div class="content" *ngIf="visibleFilter.value === transactionFilters[0]">
        <div class="row wrapped">
          <div class="mss-filter-item-label-top">
            <div class="label">{{'dictionary.from' | translate}}</div>
            <mss-date-time-picker-input formControlName="termDttmFrom" class="calendar-input"></mss-date-time-picker-input>
          </div>
          <div class="mss-filter-item-label-top">
            <div class="label">{{'dictionary.to' | translate}}</div>
            <mss-date-time-picker-input formControlName="termDttmTo" class="calendar-input"></mss-date-time-picker-input>
          </div>
        </div>
      </div>

      <!--TRANSACTION TAB-->
      <div class="content column" *ngIf="visibleFilter.value === transactionFilters[3]">
        <div class="row wrapped">
          <mss-input [label]="'dictionary.responseCode' | translate"
                     class="mss-filter-item"
                     *mssRoleIf="'admin.view'"
                     formControlName="responseCode">
          </mss-input>
          <mss-select
            class="mss-filter-item"
            *mssRoleIf="'transactions.transactionType'"
            [label]="'dictionary.transactionType' | translate"
            [options]="types"
            [clearAble]="true"
            formControlName="transactionType"></mss-select>
          <mss-select
            *mssRoleIf="'transactions.transactionState'"
            class="mss-filter-item"
            [options]="states"
            [clearAble]="true"
            [label]="'dictionary.transactionState' | translate"
            formControlName="state"></mss-select>
        </div>
        <div class="row wrapped">
          <mss-input [label]="'dictionary.approvalCode' | translate"
                     class="mss-filter-item"
                     *mssRoleIf="'transactions.approvalCode'"
                     formControlName="approvalCode">
          </mss-input>
          <mss-input [label]="'dictionary.uuid' | translate"
                     class="mss-filter-item"
                     *mssRoleIf="'transactions.uuid'"
                     formControlName="uuid">
          </mss-input>
          <mss-input [label]="'dictionary.rrn' | translate"
                     class="mss-filter-item"
                     *mssRoleIf="'transactions.rrn'"
                     formControlName="rrn">
          </mss-input>
        </div>

      </div>

      <!--LOCATION TAB-->
      <div class="content column" *ngIf="visibleFilter.value === transactionFilters[1]">
        <div class="row wrapped">
          <ng-container *ngIf="!embededObject?.issuerCode && !embededObject?.cardGroupCode">
            <mss-select
              *mssRoleIf="'dashboard.issuerCodeSelect'"
              class="mss-filter-item"
              [label]="'dictionary.issuerCode' | translate"
              labelPosition="top"
              [options]="issuerCodes"
              [clearAble]="true"
              formControlName="issuerCode"
              (selectedOptionChange)="selectIssuerCode($event)"></mss-select>
          </ng-container>
          <ng-container *ngIf="!embededObject?.cardGroupCode">
            <mss-select
              *mssRoleIf="'dashboard.cardGroupCodeSelect'"
              class="mss-filter-item"
              [options]="cardGroupCodes"
              [clearAble]="true"
              [label]="'dictionary.cardGroupCode' | translate"
              labelPosition="top"
              formControlName="cardGroupCode"></mss-select>
          </ng-container>
          <ng-container *ngIf="!embededObject?.networkCode && !embededObject?.merchantCode && !embededObject?.orgUnitCode">
            <mss-select
              class="mss-filter-item"
              *mssRoleIf="'dashboard.networkCodeSelect'"
              [label]="'dictionary.networkCode' | translate"
              labelPosition="top"
              [options]="networkCodes"
              [clearAble]="true"
              formControlName="networkCode"
              (selectedOptionChange)="selectNetworkCode($event)"></mss-select>
          </ng-container>
          <ng-container *ngIf="!embededObject?.merchantCode && !embededObject?.orgUnitCode">
            <mss-select
              class="mss-filter-item"
              *mssRoleIf="'dashboard.merchantCodeSelect'"
              [label]="'dictionary.merchantCode' | translate"
              labelPosition="top"
              [options]="merchantCodes"
              [clearAble]="true"
              formControlName="merchantCode"
              (selectedOptionChange)="selectMerchantCode($event)"></mss-select>
          </ng-container>
          <ng-container *ngIf="!embededObject?.orgUnitCode">
            <mss-select
              *mssRoleIf="'dashboard.orgUnitCodeSelect'"
              class="mss-filter-item"
              [label]="'dictionary.orgUnitCode' | translate"
              labelPosition="top"
              [options]="orgUnitCodes"
              [clearAble]="true"
              formControlName="orgUnitCode"></mss-select>
          </ng-container>
        </div>
      </div>

      <!--PAYMENT TAB-->
      <div class="content column" *ngIf="visibleFilter.value === transactionFilters[2]">
        <div class="row wrapped">
          <mss-input [label]="'dictionary.cln' | translate"
                     class="mss-filter-item"
                     *mssRoleIf="'transactions.cln'"
                     formControlName="cln">
          </mss-input>
          <mss-input [label]="'dictionary.terminalCode' | translate"
                     class="mss-filter-item"
                     *mssRoleIf="'transactions.terminalCode'"
                     formControlName="terminalCode">
          </mss-input>
          <mss-input [label]="'dictionary.amount' | translate"
                     class="mss-filter-item" [type]="'number'"
                     *mssRoleIf="'transactions.amount'"
                     formControlName="amount">
          </mss-input>
          <mss-input [label]="'dictionary.dstStan' | translate"
                     class="mss-filter-item" [type]="'number'"
                     *mssRoleIf="'transactions.dstStan'"
                     formControlName="dstStan">
          </mss-input>
          <mss-input [label]="'dictionary.specificSymbol' | translate"
                     class="mss-filter-item" [placeholder]="'Specific Symbol'"
                     *mssRoleIf="'transactions.specificSymbol'"
                     formControlName="specificSymbol">
          </mss-input>
          <mss-input [label]="'dictionary.variableSymbol' | translate"
                     class="mss-filter-item" [placeholder]="'Variable Symbol'"
                     *mssRoleIf="'transactions.variableSymbol'"
                     formControlName="vs">
          </mss-input>
        </div>
      </div>
    </div>
    <mss-button class="mss-action-button shifted" [label]="'basic.clearFilter' | translate" (click)="clearFilter()"></mss-button>
  </div>

  <div class="mss-action-button">
    <mss-button [label]="'basic.search' | translate" (click)="getTransactions()"></mss-button>
  </div>
  <div class="data-table-container">
    <ngx-datatable #table [rows]="rows" [loadingIndicator]="loading"
                   [columnMode]="'force'" [headerHeight]="70" [footerHeight]="50" [rowHeight]="48"
                   [count]="totalItems " [limit]="rowLimit"
                   [externalPaging]="true" (page)="setPage($event)"
                   [externalSorting]="true" (sort)="getSortedTransactions($event)"
                   (activate)="goToDetail('transaction', $event)">
      <ngx-datatable-column [name]="'dictionary.uuid' | translate" prop="uuid" [sortable]="false"
                            *mssRoleIf="'transactions.uuid'">
        <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
          <span [title]="value" class="mss-limited-text">{{value}}</span>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.terminalDate' | translate" prop="termDttm" [sortable]="true"
                            *mssRoleIf="'transactions.termDtm'">
        <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
          <div>{{value | mssDate}}</div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.terminalCode' | translate" prop="terminalCode" [sortable]="false"
                            *mssRoleIf="'transactions.terminalCode'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.terminalName' | translate" prop="terminalName" [sortable]="false"
                            *mssRoleIf="'transactions.terminalName'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'transactions.list.cardGroupName' | translate" prop="cardGroupName" [sortable]="false"
                            *mssRoleIf="'transactions.cardGroupName'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.orgUnitCode' | translate" prop="orgUnitCode" [sortable]="false"
                            *mssRoleIf="'createEdit.orgUnitCodeSelect'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.merchantCode' | translate" prop="merchantCode" [sortable]="false"
                            *mssRoleIf="'createEdit.merchantCodeSelect'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.cardGroupCode' | translate" prop="cardGroupCode" [sortable]="false"
                            *mssRoleIf="'createEdit.cardGroupCodeSelect'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.cln' | translate" prop="cln" [sortable]="false"
                            *mssRoleIf="'transactions.cln'">
      </ngx-datatable-column>
      <ngx-datatable-column prop="amount" [sortable]="false" *mssRoleIf="'transactions.amount'">
        <ng-template ngx-datatable-header-template>
          <div class="mss-header-cell-align-right">{{'dictionary.amount' | translate}}</div>
        </ng-template>
        <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
          <div class="mss-cell-align-right">{{value | currency:row['currency']['code']:true:'1.' + row['currency']['digits']}}</div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.transactionType' | translate" prop="transactionType"
                            [sortable]="false" *mssRoleIf="'transactions.transactionType'">
        <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
          <i class="material-icons" [title]="value">{{getTransactionTypeIcon(value)}}</i>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.responseCode' | translate" prop="responseCode" [sortable]="false"
                            *mssRoleIf="'transactions.responseCode'">
        <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
          <div [ngClass]="{'status-declined': row['state'] === 'DECLINED', 'status-accepted': row['state'] === 'ACCEPTED'}"
               [title]="row['coreResponseCode']">
            {{value}}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.variableSymbol' | translate" prop="vs" [sortable]="false"
                            *mssRoleIf="'transactions.variableSymbol'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.specificSymbol' | translate" prop="specificSymbol" [sortable]="false"
                            *mssRoleIf="'transactions.specificSymbol'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.approvalCode' | translate" prop="approvalCode" [sortable]="false"
                            *mssRoleIf="'transactions.approvalCode'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.dstStan' | translate" prop="dstStan" [sortable]="false"
                            *mssRoleIf="'transactions.dstStan'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.rrn' | translate" prop="rrn" [sortable]="false"
                            *mssRoleIf="'transactions.rrn'">
      </ngx-datatable-column>

      <ngx-datatable-footer>
        <ng-template
          ngx-datatable-footer-template
          let-rowCount="rowCount"
          let-pageSize="pageSize"
          let-curPage="curPage">
          <mss-table-footer
            [page]="curPage"
            [rowsShown]="pageSize"
            [rowCount]="rowCount"
            (rowsShownChange)="changeLimit($event)"
            (changePage)="table.onFooterPage($event)"
            class="d-table-footer">
          </mss-table-footer>
        </ng-template>
      </ngx-datatable-footer>
    </ngx-datatable>
  </div>
</div>
