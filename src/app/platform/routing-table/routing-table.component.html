<div class="routing-table-container">
  <div class="button-container">
    <mss-button class="routing-table-btn" (click)="switchModal()" [label]="'Add table'"></mss-button>
  </div>
  <div *ngIf="rows.length > 0" class="data-table-container">
    <ngx-datatable #table [columns]="columns" [loadingIndicator]="loading" [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50"
                   [rowHeight]="'auto'" [limit]="rowLimit" [rows]="rows">
      <ngx-datatable-column name="Name">
        <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
          <span class="cell click-able" (click)="selectRow(row)">{{value}}</span>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Description">
        <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
          <div class="cell" *ngIf="edit !== row.$$index">{{value}}</div>
          <input class="table-input" autofocus *ngIf="edit === row.$$index" type="text" [(ngModel)]="editModel"/>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Edit" [maxWidth]="140">
        <ng-template ngx-datatable-cell-template let-row="row">
          <i *ngIf="edit !== row.$$index" (click)="editing(row.$$index)" class="material-icons click-able">edit</i>
          <i *ngIf="edit === row.$$index" (click)="saveTable(row.$$index)" class="material-icons click-able">done</i>
          <i *ngIf="edit === row.$$index" (click)="clearEdit()" class="material-icons click-able">not_interested</i>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="Delete" [maxWidth]="80">
        <ng-template ngx-datatable-cell-template let-row="row">
          <i (click)="showDeleteModal(row)" class="material-icons click-able">clear</i>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-footer>
        <ng-template
          ngx-datatable-footer-template
          let-rowCount="rowCount"
          let-pageSize="pageSize"
          let-curPage="curPage">
          <mss-table-footer
            [page]="curPage"
            [rowsShown]="pageSize"
            [rowCount]="rowCount"
            (rowsShownChange)="changeLimit($event)"
            (changePage)="table.onFooterPage($event)"
            class="d-table-footer">
          </mss-table-footer>
        </ng-template>
      </ngx-datatable-footer>
    </ngx-datatable>
  </div>
</div>

<mss-modal-window [(visible)]="modalShowing">
  <form [formGroup]="newTableForm" (ngSubmit)="addRoutingTable()">
    <div class="routing-table-modal-container">
      <div class="close-wrapper" (click)="switchModal()">
        <div class="close">+</div>
      </div>
      <div class="mss-title">New Routing Table</div>
      <div class="name-wrapper routing-table-modal-input">
        <mss-input formControlName="name" [label]="'Name'" [(value)]="newTable.name"></mss-input>
        <div *ngIf="showMessage()" class="warning-text">This name is already in table</div>
      </div>
      <mss-input formControlName="description" class="routing-table-modal-input" [label]="'Description'"
                 [(value)]="newTable.description"></mss-input>
      <mss-button [disabled]="newTableForm.invalid" [label]="'Save'"></mss-button>
    </div>
  </form>
</mss-modal-window>

<mss-modal-window [(visible)]="warnModalVisible">
  <div class="mss-title">Opravdu chcete záznam odstranit?</div>
  <div class="modal-buttons">
    <mss-button class="button" label="Zavřít" (click)="warnModalVisible = false"></mss-button>
    <mss-button class="button" label="Ano" (click)="deleteRow()"></mss-button>
  </div>
</mss-modal-window>
