<div class="card-groups-container">
  <div class="header">
    <span>{{'cardGroups.title' | translate}}</span>
    <mss-button class="button" (click)="addCardGroup()" [label]="'cardGroups.addCardGroup' | translate"
                *mssRoleIf="'cardGroups.create'">
    </mss-button>
  </div>
  <form [formGroup]="filterForm" (ngSubmit)="getCardGroups()">
    <div class="filter">
      <div class="select-row">
        <div class="filter-item">
          <mss-select [options]="issuerCodes" *mssRoleIf="'filters.issuerCodeSelect'"
                      formControlName="issuerCode" [disabled]="issuerCodes.length === 0"
                      [label]="'dictionary.issuerCode' | translate"></mss-select>
        </div>
        <mss-button class="button" type="button" (click)="clearFilter()" [label]="'basic.clearFilter' | translate"></mss-button>
      </div>
      <div class="filter-item">
        <mss-select [options]="cardGroupCodes" [disabled]="cardGroupCodes.length === 0"
                    formControlName="cardGroupCode"
                    [label]="'dictionary.cardGroupCode' | translate"></mss-select>
      </div>
      <div class="filter-item">
        <mss-input [label]="'basic.name' | translate" formControlName="name"></mss-input>
      </div>
      <div class="filter-item">
        <mss-input [label]="'basic.id' | translate" formControlName="id"></mss-input>
      </div>
      <div class="button">
        <mss-button [label]="'cardGroups.search' | translate" type="submit"></mss-button>
      </div>
    </div>
  </form>

  <div *ngIf="rows" class="data-table-container">
    <ngx-datatable #table [externalPaging]="true" [loadingIndicator]="loading" [count]="tableData ? tableData.totalElements : 0 "
                   [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'"
                   (activate)="goToDetail($event)"
                   [externalSorting]="true"
                   (sort)="getSortedCardGroups($event)"
                   [limit]="requestModel.pagination.number" [rows]="rows" (page)="setPage($event)">
      <ngx-datatable-column [name]="'basic.code' | translate" prop="code" [sortable]="true"></ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.issuerCode' | translate" prop="issuerCode"
                            [sortable]="false" *mssRoleIf="'admin.view'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'basic.name' | translate" prop="name" [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'basic.id' | translate" prop="id" [sortable]="false" [cellClass]="'mss-click-able'">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.specificSymbol' | translate" prop="specificSymbol" [sortable]="false">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'basic.ico' | translate" prop="ico" [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.bankAccount' | translate" prop="bankAccount" [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.state' | translate" prop="state" [sortable]="false"></ngx-datatable-column>

      <ngx-datatable-footer>
        <ng-template
          ngx-datatable-footer-template
          let-rowCount="rowCount"
          let-pageSize="pageSize"
          let-curPage="curPage">
          <mss-table-footer
            [page]="curPage"
            [rowsShown]="pageSize"
            [rowCount]="rowCount"
            (rowsShownChange)="changeLimit($event)"
            (changePage)="table.onFooterPage($event)"
            class="d-table-footer">
          </mss-table-footer>
        </ng-template>
      </ngx-datatable-footer>
    </ngx-datatable>
  </div>
  <mss-modal-window [(visible)]="modalVisible">
    <div class="header">
      {{'cardGroups.addCardGroup' | translate}}
    </div>
    <div class="content">
      <div class="tabs">
        <mss-tabs [items]="tabsOptions" (itemChanged)="visibleTab = $event"></mss-tabs>
      </div>
      <form novalidate [formGroup]="newCardGroupForm" class="form" (ngSubmit)="createNewCardGroup()">
        <div class="section" [ngClass]="{'visible': visibleTab.value === CardGroupSections.BASIC}">
          <div class="column">
            <div class="form-item">
              <mss-input [label]="('basic.name' | translate) +'*'" formControlName="name"></mss-input>
              <div class="mss-validation-label">
                <span *ngIf="isInvalid('name')">Jméno musí být vyplněno!</span>
              </div>
            </div>
            <div class="form-item">
              <mss-input [label]="('basic.code' | translate) +'*'" formControlName="code"></mss-input>
              <div class="mss-validation-label">
                <span *ngIf="isInvalid('code')">Kod musí být vyplněn!</span>
              </div>
            </div>
            <div class="form-item">
              <mss-input [label]="'dictionary.externalCode' | translate" formControlName="externalCode"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
          </div>
          <div class="column">
            <div class="form-item">
              <mss-select [label]="('dictionary.issuerCode' | translate) +'*'" [options]="issuerCodes"
                          formControlName="issuerCode"></mss-select>
              <div class="mss-validation-label">
                <span *ngIf="isInvalid('issuerCode')">Kod provozovatele musí být vyplněn!</span>
              </div>
            </div>
            <div class="form-item">
              <mss-select [label]="'dictionary.state' | translate" [options]="states" formControlName="state"></mss-select>
              <div class="mss-validation-label"></div>
            </div>
          </div>
        </div>
        <div class="section" [ngClass]="{'visible': visibleTab.value === CardGroupSections.LIMITS}">
          <div class="column">
            <div class="form-item">
              <mss-input [label]="'dictionary.limitType' | translate" formControlName="limitType"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
          </div>
          <div class="column">
            <div class="form-item">
              <mss-input [label]="'dictionary.limit' | translate" type="number" formControlName="limit"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
          </div>
        </div>
        <div class="section" [ngClass]="{'visible': visibleTab.value === CardGroupSections.CONTACTS}">
          <div class="column">
            <div class="form-item">
              <mss-input [label]="'basic.ico' | translate" formControlName="ico"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
            <div class="form-item">
              <mss-input [label]="'basic.dic' | translate" formControlName="dic"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
            <div class="form-item">
              <mss-input [label]="'basic.email' | translate" formControlName="email"></mss-input>
              <div class="mss-validation-label">
                <span *ngIf="isInvalid('email')">Neplatný email!</span>
              </div>
            </div>
            <div class="form-item">
              <mss-input [label]="'basic.phone' | translate" formControlName="phone"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
            <div class="form-item">
              <mss-input [label]="'basic.contact' | translate" formControlName="contact"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
            <div class="form-item">
              <mss-input [label]="'basic.contact2' | translate" formControlName="contact2"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
          </div>
          <div class="column">
            <div class="form-item">
              <mss-input [label]="'dictionary.bankAccount' | translate" formControlName="bankAccount"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
            <div class="form-item">
              <mss-toggle [label]="'cardGroups.createSpecificSymbol' | translate" formControlName="createSpecSymbol"></mss-toggle>
              <div class="mss-validation-label"></div>
            </div>
            <div class="form-item">
              <mss-input [label]="'dictionary.specificSymbol' | translate" formControlName="specificSymbol"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
            <div class="form-item">
              <mss-select [label]="'dictionary.taxType' | translate" [options]="taxTypes" formControlName="taxType"></mss-select>
              <div class="mss-validation-label"></div>
            </div>
            <div class="form-item">
              <mss-input [label]="'dictionary.tax' | translate" type="number" formControlName="taxValue"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
          </div>
        </div>
        <div class="section" [ngClass]="{'visible': visibleTab.value === CardGroupSections.ADDRESS}">
          <div class="column">
            <div class="form-item">
              <mss-toggle [label]="'cardGroups.useDeliveryAddress' | translate" formControlName="createDefaultDeliveryAddress"></mss-toggle>
              <div class="mss-validation-label"></div>
            </div>
          </div>
          <div class="column">
            <div class="form-item">
              <mss-input [label]="'basic.street' | translate" formControlName="street"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
            <div class="form-item">
              <mss-input [label]="'basic.city' | translate" formControlName="city"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
            <div class="form-item">
              <mss-input [label]="'basic.zip' | translate" formControlName="zip"></mss-input>
              <div class="mss-validation-label"></div>
            </div>
          </div>
        </div>
        <div class="submit-button">
          <mss-button [label]="'cardGroups.addCardGroup' | translate" type="submit" [disabled]="newCardGroupForm.invalid"></mss-button>
        </div>
      </form>
    </div>
  </mss-modal-window>
</div>

