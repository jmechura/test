<div class="issuer-card-container">
  <div class="mss-header-row">
    <span class="mss-title">{{'cards.cardRequests.title' | translate}}</span>
  </div>

  <div class="filter-container">
    <div class="filters">
      <div class="calendar-select filter-item">
        <div class="label">{{'dictionary.from' | translate}}</div>
        <mss-date-picker-input class="date-picker" [pickedDate]="fromDate"
                               (pickedDateChange)="changeFromDate($event)"></mss-date-picker-input>
      </div>
      <div class="calendar-select filter-item">
        <div class="label">{{'dictionary.to' | translate}}</div>
        <mss-date-picker-input class="date-picker" [pickedDate]="toDate" (pickedDateChange)="changeToDate($event)"></mss-date-picker-input>
      </div>
      <mss-select [disabled]="issuerCodes.length === 0"
                  *mssRoleIf="'cardRequests.issuerCodeSelect'"
                  class="filter-item"
                  [label]="'dictionary.issuerCode' | translate"
                  labelPosition="top"
                  [options]="issuerCodes"
                  [clearAble]="true"
                  [selectedOption]="searchModel.search.predicateObject.issuerCode"
                  (selectedOptionChange)="selectIssuerCode($event)"></mss-select>
      <mss-select [disabled]="cardGroupCodes.length === 0"
                  *mssRoleIf="'cardRequests.cardGroupCodeSelect'"
                  class="filter-item"
                  [options]="cardGroupCodes"
                  [clearAble]="true"
                  [label]="'dictionary.cardGroupCode' | translate"
                  labelPosition="top"
                  [(selectedOption)]="searchModel.search.predicateObject.cardGroupCode"></mss-select>
      <mss-select [disabled]="requestStates.length === 0"
                  class="filter-item"
                  [options]="requestStates"
                  labelPosition="top"
                  [label]="'dictionary.state' | translate"
                  [(selectedOption)]="searchModel.search.predicateObject.state"></mss-select>
    </div>
    <mss-button class="mss-action-button bottom" [label]="'basic.clearFilter' | translate" (click)="clearFilter()"></mss-button>
  </div>

  <div class="mss-action-button">
    <mss-button [label]="'basic.search' | translate" (click)="getRequests()"></mss-button>
  </div>

  <div class="table-container">
    <ngx-datatable #table (activate)="goToDetail($event)" [externalPaging]="true"
                   [count]="tableData ? tableData.totalElements : 0 " [loadingIndicator]="loading"
                   (page)="setPage($event)"
                   [externalSorting]="true"
                   (sort)="getSortedCardRequests($event)"
                   [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50" [rowHeight]="48" [limit]="searchModel.pagination.number"
                   [rows]="rows">
      <ngx-datatable-column [name]="'basic.id' | translate" prop="uuid" [sortable]="true">
        <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
          <span [title]="value" class="mss-limited-text">{{value}}</span>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.cardGroupCode' | translate" prop="cardGroupCode" [sortable]="true">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'cards.cardRequests.employerName' | translate" prop="cardGroupName"
                            [sortable]="true"></ngx-datatable-column>
      <ngx-datatable-column [name]="'cards.cardRequests.created' | translate" prop="created" [sortable]="true">
        <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
          <div>{{getFormattedDate(value)}}</div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'cards.cardRequests.createdBy' | translate" prop="createdBy" [sortable]="true">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'cards.cardRequests.numberOfCards' | translate" prop="cardNumber"
                            [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'cards.cardRequests.processedCard' | translate" prop="processedCard"
                            [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'cards.cardRequests.sendCard' | translate" prop="sendCard"
                            [sortable]="false"></ngx-datatable-column>
      <ngx-datatable-column [name]="'dictionary.state' | translate" prop="state" [sortable]="false">
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'cards.cardRequests.decline' | translate" [maxWidth]="100"
                            [sortable]="false" *mssRoleIf="'cardRequests.confirm'">
        <ng-template ngx-datatable-cell-template let-row="row">
          <i class="material-icons table-icon" (click)="handleActionClick(row, 'decline', $event)">clear</i>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [name]="'cards.cardRequests.accept' | translate" [maxWidth]="100"
                            [sortable]="false" *mssRoleIf="'cardRequests.confirm'">
        <ng-template ngx-datatable-cell-template let-row="row">
          <i class="material-icons table-icon" (click)="handleActionClick(row, 'confirm', $event)">done</i>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-footer>
        <ng-template
          ngx-datatable-footer-template
          let-rowCount="rowCount"
          let-pageSize="pageSize"
          let-curPage="curPage">
          <mss-table-footer
            [page]="curPage"
            [rowsShown]="pageSize"
            [rowCount]="rowCount"
            (rowsShownChange)="changeLimit($event)"
            (changePage)="table.onFooterPage($event)"
            class="d-table-footer">
          </mss-table-footer>
        </ng-template>
      </ngx-datatable-footer>
    </ngx-datatable>
  </div>
</div>

<mss-modal-window [(visible)]="modalVisible">
  <h3 class="mss-modal-title" *ngIf="modalDisplaying === 'confirm'">{{'cards.cardRequests.warnModal.titleAccept' | translate}}</h3>
  <h3 class="mss-modal-title" *ngIf="modalDisplaying !== 'confirm'">{{'cards.cardRequests.warnModal.titleDecline' | translate}}</h3>
  <div class="modal-buttons">
    <mss-button class="button" [label]="'basic.yes' | translate"
                (click)="modalDisplaying === 'confirm' ? sendConfirm() : sendDecline()"></mss-button>
    <mss-button class="button" [label]="'basic.dismiss' | translate" (click)="modalVisible = false"></mss-button>
  </div>
</mss-modal-window>
