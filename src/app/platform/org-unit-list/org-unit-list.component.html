<div class="mss-view-container" xmlns="">
  <div class="view-header">
    <h1 class="mss-title">{{'orgUnits.list.title' | translate}}</h1>
    <mss-button [label]="'orgUnits.list.addOrgUnit' | translate" (click)="showCreateModal()" *mssRoleIf="'orgUnits.create'"></mss-button>
  </div>

  <div class="row">
    <div class="column" [formGroup]="filterForm">
      <mss-tabs class="tabs" [items]="filterOptions" (itemChanged)="visibleFilter = $event"></mss-tabs>

      <div class="content column" *ngIf="visibleFilter.value ===  OrgUnitFilterSections.BASIC">
        <div class="row wrapped">
          <mss-input class="filter-item" formControlName="name" [label]="'basic.name' | translate"></mss-input>
          <mss-input class="filter-item" formControlName="code" [label]="'basic.code' | translate"></mss-input>
        </div>
      </div>
      <div class="content column" *ngIf="visibleFilter.value ===  OrgUnitFilterSections.NETWORK">
        <div class="row wrapped" *mssRoleIf="'filters.networkCodeSelect'">
          <mss-input class="filter-item" formControlName="networkName" [label]="'orgUnits.dictionary.networkName' | translate"></mss-input>
          <mss-select class="filter-item" formControlName="networkCode" [options]="networkCodes"
                      [label]="'dictionary.networkCode' | translate"></mss-select>
        </div>
        <div class="row wrapped" *mssRoleIf="'filters.merchantCodeSelect'">
          <mss-input class="filter-item" formControlName="merchantName"
                     [label]="'orgUnits.dictionary.merchantName' | translate"></mss-input>
          <mss-select class="filter-item" formControlName="merchantId" [options]="merchantCodes"
                      [label]="'orgUnits.dictionary.merchantId' | translate"></mss-select>
        </div>
      </div>
    </div>
    <mss-button class="button shifted" [label]="'basic.clearFilter' | translate" (click)="clearFilter()"></mss-button>
  </div>

  <div class="button">
    <mss-button [label]="'orgUnits.list.search' | translate" (click)="getOrgUnits()"></mss-button>
  </div>

  <div class="org-unit-list">
    <div class="data-table-container">
      <ngx-datatable #table [rows]="tableRows" [headerHeight]="50" [footerHeight]="50" rowHeight="auto" columnMode="force"
                     [externalPaging]="true"
                     [externalSorting]="true" (sort)="getSortedOrgUnits($event)"
                     [count]="totalItems" [limit]="itemLimit" [offset]="pageNumber" (page)="setPage($event)">
        <ngx-datatable-column [name]="'basic.name' | translate" prop="name" [sortable]="true"></ngx-datatable-column>
        <ngx-datatable-column [name]="'basic.code' | translate" prop="code" [sortable]="true"></ngx-datatable-column>
        <ngx-datatable-column [name]="'basic.id' | translate" prop="id" [sortable]="true"></ngx-datatable-column>
        <ngx-datatable-column [name]="'dictionary.networkCode' | translate" prop="networkCode" [sortable]="false" *mssRoleIf="'admin.view'">
        </ngx-datatable-column>
        <ngx-datatable-column [name]="'dictionary.merchantCode' | translate" prop="merchantCode" [sortable]="false"></ngx-datatable-column>
        <ngx-datatable-column [name]="'dictionary.externalCode' | translate" prop="externalCode" [sortable]="false"></ngx-datatable-column>
        <ngx-datatable-column [name]="'basic.street' | translate" prop="street" [sortable]="false"></ngx-datatable-column>
        <ngx-datatable-column [name]="'basic.city' | translate" prop="city" [sortable]="false"></ngx-datatable-column>
        <ngx-datatable-column [name]="'basic.region' | translate" prop="region" [sortable]="false"></ngx-datatable-column>
        <ngx-datatable-column [name]="'basic.country' | translate" prop="country" [sortable]="false"></ngx-datatable-column>
        <ngx-datatable-column [name]="'basic.note' | translate" prop="note" [sortable]="false" *mssRoleIf="'admin.view'">
        </ngx-datatable-column>
        <ngx-datatable-column [name]="'dictionary.state' | translate" prop="state" [sortable]="false">
          <ng-template ngx-datatable-cell-template let-value="value">
            <span class="mss-datatable-state-value" [ngClass]="{'disabled': value === 'DISABLED'}">{{value}}</span>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [name]="'basic.options' | translate" [sortable]="false">
          <ng-template ngx-datatable-cell-template let-row="row">
            <a class="row-action">
              <i class="material-icons" [routerLink]="getDetailLink(row.id)" [title]="'basic.showDetail' | translate">description</i>
            </a>
            <ng-container *mssRoleIf="'orgUnits.edit'">
              <a class="row-action" *ngIf="row.state !== 'DISABLED'">
                <i class="material-icons" (click)="showDeleteModal(row.id)" [title]="'basic.delete' | translate">delete</i>
              </a>
            </ng-container>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-footer>
          <ng-template ngx-datatable-footer-template>
            <mss-table-footer
              [page]="pageNumber"
              [rowsShown]="itemLimit"
              [rowCount]="totalItems"
              (rowsShownChange)="itemsPerPage($event)"
              (changePage)="table.onFooterPage($event)"
              class="d-table-footer">
            </mss-table-footer>
          </ng-template>
        </ngx-datatable-footer>
      </ngx-datatable>
    </div>
  </div>
</div>

<mss-modal-window [(visible)]="createModalShown" *mssRoleIf="'orgUnits.create'">
  <h1 class="create-dialog-title">{{'orgUnits.list.addOrgUnit' | translate}}</h1>
  <mss-org-unit-form (modelSubmit)="createOrgUnit($event)" (dismiss)="hideCreateModal()"></mss-org-unit-form>
</mss-modal-window>

<mss-modal-window [(visible)]="deleteModalShown">
  <div class="delete-prompt">
    <h1>{{'orgUnits.list.removeQuestion' | translate}}</h1>
    <div class="delete-prompt-footer">
      <mss-button class="delete-prompt-action" [label]="'basic.dismiss' | translate" (click)="hideDeleteModal()"></mss-button>
      <mss-button class="delete-prompt-action" [label]="'basic.delete' | translate" (click)="deleteOrgUnit()"></mss-button>
    </div>
  </div>
</mss-modal-window>
