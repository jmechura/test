<div class="terminal-container mss-view-container">
  <div class="mss-title">{{'terminals.title' | translate}}</div>
  <mss-button class="action-button" [label]="'terminals.addTerminal' | translate"
              (click)="switchModal()" *mssRoleIf="'terminals.create'"></mss-button>
  <ngx-datatable #table [externalPaging]="true" [loadingIndicator]="loading" [count]="terminalData ? terminalData.totalElements : 0 "
                 [offset]="terminalData ? terminalData.number : 0" [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50"
                 [rowHeight]="'auto'" [externalSorting]="true" (sort)="getSortedTerminals($event)"
                 [limit]="pagination.pagination.number" [rows]="terminalRows" (page)="setPage($event)">
    <ngx-datatable-column [name]="'basic.name' | translate" prop="name" [cellClass]="'mss-click-able'"
                          [sortable]="true"></ngx-datatable-column>
    <ngx-datatable-column [name]="'basic.code' | translate" prop="code" [sortable]="true"></ngx-datatable-column>
    <ngx-datatable-column [name]="'dictionary.orgUnitCode' | translate" prop="orgUnitCode"
                          [sortable]="true" *mssRoleIf="'filters.orgUnitCodeSelect'">
    </ngx-datatable-column>
    <ngx-datatable-column [name]="'dictionary.merchantCode' | translate" prop="merchantCode"
                          [sortable]="true" *mssRoleIf="'filters.merchantCodeSelect'">
    </ngx-datatable-column>
    <ngx-datatable-column [name]="'basic.street' | translate" prop="street" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-column [name]="'basic.city' | translate" prop="city" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-column [name]="'basic.region' | translate" prop="region" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-column [name]="'basic.country' | translate" prop="country" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-column [name]="'dictionary.state' | translate" prop="state" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-column [name]="'dictionary.state' | translate" prop="state" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-column [name]="'basic.edit' | translate" [resizeable]="false" [draggable]="false" [sortable]="false"
                          *mssRoleIf="'terminals.edit'">
      <ng-template ngx-datatable-cell-template let-row="row">
        <i class="material-icons click-able" (click)="editing(row)">edit</i>
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-row-detail [rowHeight]="350">
      <ng-template let-row="row" ngx-datatable-row-detail-template>
        <div class="detail-row-container">
          <div class="detail-column">
            <mss-input class="detail-shift" [label]="'basic.name' | translate" [(value)]="editModel.name"></mss-input>
            <mss-input class="detail-shift" [label]="'basic.street' | translate" [(value)]="editModel.street"></mss-input>
            <mss-input class="detail-shift" [label]="'basic.city' | translate" [(value)]="editModel.city"></mss-input>
            <mss-input [label]="'basic.zip' | translate" [(value)]="editModel.zip"></mss-input>
          </div>

          <div class="detail-column">
            <mss-toggle class="detail-shift" [label]="'dictionary.state' | translate" [(toggled)]="editToggle"></mss-toggle>
            <mss-input class="detail-shift" [label]="'basic.region' | translate" [(value)]="editModel.region"></mss-input>
            <mss-input class="detail-shift" [label]="'basic.country' | translate" [(value)]="editModel.country"></mss-input>
            <mss-input class="detail-shift" [label]="'basic.note' | translate" [(value)]="editModel.note"></mss-input>
            <mss-button class="edit-button" [label]="'basic.save' | translate" (click)="saveEditing()"
                        [disabled]="editSaveDisabled()"></mss-button>
          </div>
        </div>
      </ng-template>
    </ngx-datatable-row-detail>
    <ngx-datatable-footer>
      <ng-template
        ngx-datatable-footer-template
        let-rowCount="rowCount"
        let-pageSize="pageSize"
        let-curPage="curPage">
        <mss-table-footer
          [page]="curPage"
          [rowsShown]="pageSize"
          [rowCount]="rowCount"
          (rowsShownChange)="changeLimit($event)"
          (changePage)="table.onFooterPage($event)"
          class="d-table-footer">
        </mss-table-footer>
      </ng-template>
    </ngx-datatable-footer>
  </ngx-datatable>
</div>

<mss-modal-window [(visible)]="modalShowing" *mssRoleIf="'terminals.create'">
  <form [formGroup]="newTerminalForm" (ngSubmit)="addTerminal()">
    <div class="terminal-modal-container">
      <div class="close-wrapper" (click)="switchModal()">
        <div class="close">+</div>
      </div>
      <div class="mss-title">{{'terminals.addTerminal' | translate}}</div>
      <div class="new-terminal-inputs">
        <div class="modal-column">
          <mss-input class="modal-input" [label]="'basic.name' | translate" formControlName="name"></mss-input>
          <mss-input class="modal-input" [label]="'basic.street' | translate" formControlName="street"></mss-input>
          <mss-input class="modal-input" [label]="'basic.city' | translate" formControlName="city"></mss-input>
          <mss-input class="modal-input" [label]="'basic.zip' | translate" formControlName="zip"></mss-input>
          <mss-input class="modal-input" [label]="'basic.region' | translate" formControlName="region"></mss-input>
          <mss-input class="modal-input" [label]="'basic.country' | translate" formControlName="country"></mss-input>
        </div>
        <div class="modal-column">
          <mss-input class="modal-input" [label]="'basic.code' | translate" formControlName="code"></mss-input>
          <mss-select class="modal-input" [label]="'dictionary.networkCode' | translate" [options]="networkCodes"
                      formControlName="networkCode" *mssRoleIf="'filters.networkCodeSelect'"></mss-select>
          <mss-select class="modal-input" [label]="'dictionary.merchantCode' | translate" [options]="merchantCodes"
                      formControlName="merchantId" *mssRoleIf="'filters.merchantCodeSelect'"></mss-select>
          <mss-select class="modal-input" [label]="'dictionary.orgUnitCode' | translate" [options]="orgUnitCodes"
                      formControlName="orgUnitId" *mssRoleIf="'filters.orgUnitCodeSelect'"></mss-select>
          <mss-input class="modal-input" [type]="'number'" [label]="'basic.coefficient' | translate"
                     formControlName="coefficient"></mss-input>
          <mss-input class="modal-input" [label]="'basic.note' | translate" formControlName="note"></mss-input>
          <mss-button [label]="'terminals.addTerminal' | translate" [disabled]="newFormInvalid"></mss-button>
        </div>
      </div>
    </div>
  </form>
</mss-modal-window>
