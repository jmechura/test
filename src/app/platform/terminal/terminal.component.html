<div class="terminal-container">
  <div class="mss-header-row">
    <span class="mss-title">{{'terminals.title' | translate}}</span>
    <mss-button class="mss-action-button" [label]="'terminals.addTerminal' | translate"
                (click)="switchModal()" *mssRoleIf="'terminals.create'">
    </mss-button>
  </div>

  <div class="filter-container">
    <div class="filters" [formGroup]="filterForm">
      <mss-select *mssRoleIf="'filters.networkCodeSelect'"
                  class="filter-item"
                  [options]="networkCodes"
                  [label]="'dictionary.networkCode' | translate"
                  formControlName="networkCode"
                  labelPosition="top"
                  (selectedOptionChange)="networkSelect($event)"></mss-select>
      <mss-select *mssRoleIf="'filters.merchantCodeSelect'"
                  class="filter-item"
                  [options]="merchantCodes"
                  [label]="'dictionary.merchantCode' | translate"
                  formControlName="merchantCode"
                  labelPosition="top"
                  (selectedOptionChange)="merchantSelect($event)"></mss-select>
      <mss-select *mssRoleIf="'filters.orgUnitCodeSelect'"
                  class="filter-item"
                  [options]="orgUnitCodes"
                  [label]="'dictionary.orgUnitCode' | translate"
                  formControlName="orgUnitCode"
                  labelPosition="top"></mss-select>
      <mss-input formControlName="code" class="filter-item"
                 [label]="'basic.code' | translate" labelPosition="top">
      </mss-input>
      <mss-input formControlName="name" class="filter-item"
                 [label]="'basic.name' | translate" labelPosition="top">
      </mss-input>
    </div>
    <mss-button class="mss-action-button bottom" [label]="'basic.clearFilter' | translate" (click)="clearFilter()"></mss-button>
  </div>

  <div class="mss-action-button">
    <mss-button [label]="'basic.search' | translate" (click)="getTerminalList()"></mss-button>
  </div>

  <ngx-datatable #table [externalPaging]="true" [loadingIndicator]="loading" [count]="terminalData ? terminalData.totalElements : 0 "
                 [headerHeight]="70" [footerHeight]="50"
                 [rowHeight]="'auto'" [externalSorting]="true" [limit]="rowLimit"
                 [rows]="terminalRows" [selectionType]="'single'" (select)="onSelect($event)"
                 (page)="setPage($event)" (sort)="getSortedTerminals($event)"
                 [offset]="terminalData ? terminalData.number : 0">
    <ngx-datatable-column [name]="'basic.name' | translate" prop="name" [cellClass]="'mss-click-able'"
                          [sortable]="true"></ngx-datatable-column>
    <ngx-datatable-column [name]="'basic.code' | translate" prop="code" [sortable]="true"></ngx-datatable-column>
    <ngx-datatable-column [name]="'dictionary.orgUnitCode' | translate" prop="orgUnitCode"
                          [sortable]="true" *mssRoleIf="'filters.orgUnitCodeSelect'">
    </ngx-datatable-column>
    <ngx-datatable-column [name]="'dictionary.merchantCode' | translate" prop="merchantCode"
                          [sortable]="true" *mssRoleIf="'filters.merchantCodeSelect'">
    </ngx-datatable-column>
    <ngx-datatable-column [name]="'basic.street' | translate" prop="street" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-column [name]="'basic.city' | translate" prop="city" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-column [name]="'basic.region' | translate" prop="region" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-column [name]="'basic.country' | translate" prop="country" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-column [name]="'dictionary.state' | translate" prop="state" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-column [name]="'dictionary.state' | translate" prop="state" [sortable]="false"></ngx-datatable-column>
    <ngx-datatable-footer>
      <ng-template
        ngx-datatable-footer-template
        let-rowCount="rowCount"
        let-pageSize="pageSize"
        let-curPage="curPage">
        <mss-table-footer
          [page]="curPage"
          [rowsShown]="pageSize"
          [rowCount]="rowCount"
          (rowsShownChange)="changeLimit($event)"
          (changePage)="table.onFooterPage($event)"
          class="d-table-footer">
        </mss-table-footer>
      </ng-template>
    </ngx-datatable-footer>
  </ngx-datatable>
</div>

<mss-modal-window [(visible)]="modalShowing" *mssRoleIf="'terminals.create'">
  <h3 class="mss-modal-title">{{'terminals.addTerminal' | translate}}</h3>
  <form [formGroup]="newTerminalForm" (ngSubmit)="addTerminal()" class="new-terminal-form">
    <div class="new-terminal-inputs">
      <div class="new-terminal-input-side">
        <mss-input [label]="('basic.name' | translate) + '*'"
                   formControlName="name"
                   [warn]="isPresent('name')">
        </mss-input>
        <div class="mss-validation-label">
          <span *ngIf="isPresent('name')">{{'basic.required.name' | translate}}</span>
        </div>
        <mss-select [label]="'basic.country' | translate"
                    [options]="countries"
                    formControlName="country">
        </mss-select>
        <div class="mss-validation-label"></div>
        <mss-input [label]="'basic.street' | translate"
                   formControlName="street">
        </mss-input>
        <div class="mss-validation-label"></div>
        <mss-input [label]="'basic.city' | translate"
                   formControlName="city">
        </mss-input>
        <div class="mss-validation-label"></div>
        <mss-input [label]="'basic.zip' | translate"
                   formControlName="zip">
        </mss-input>
        <div class="mss-validation-label"></div>
        <mss-input [label]="'basic.region' | translate"
                   formControlName="region">
        </mss-input>
      </div>
      <div class="new-terminal-input-side">
        <mss-input [label]="('basic.code' | translate) + '*'"
                   formControlName="code"
                   [warn]="isPresent('code')">
        </mss-input>
        <div class="mss-validation-label">
          <span *ngIf="isPresent('code')">{{'basic.required.code' | translate}}</span>
        </div>
        <mss-select [label]="('dictionary.networkCode' | translate) + '*'"
                    [options]="networkCodes"
                    formControlName="networkCode"
                    *mssRoleIf="'filters.networkCodeSelect'">
        </mss-select>
        <div class="mss-validation-label">
          <span *ngIf="isPresent('networkCode')">{{'basic.required.networkCode' | translate}}</span>
        </div>
        <mss-select [label]="('dictionary.merchantCode' | translate) + '*'"
                    [options]="merchantCodes"
                    formControlName="merchantId"
                    *mssRoleIf="'filters.merchantCodeSelect'">
        </mss-select>
        <div class="mss-validation-label">
          <span *ngIf="isPresent('merchantId')">{{'basic.required.merchantId' | translate}}</span>
        </div>
        <mss-select [label]="('dictionary.orgUnitCode' | translate) + '*'"
                    [options]="orgUnitCodes"
                    formControlName="orgUnitId"
                    *mssRoleIf="'filters.orgUnitCodeSelect'">
        </mss-select>
        <div class="mss-validation-label">
          <span *ngIf="isPresent('orgUnitId')">{{'basic.required.orgUnitId' | translate}}</span>
        </div>
        <mss-input [type]="'number'"
                   [label]="'basic.coefficient' | translate"
                   formControlName="coefficient">
        </mss-input>
        <div class="mss-validation-label"></div>
        <mss-input [label]="'basic.note' | translate"
                   formControlName="note">
        </mss-input>
      </div>
    </div>
    <div class="mss-buttons-row">
      <mss-button label="{{'basic.dismiss' | translate}}" class="mss-action-button right-margin" type="button"
                  (click)="switchModal()"></mss-button>
      <mss-button label="{{'basic.add' | translate}}" class="mss-action-button" type="submit"
                  [disabled]="newFormInvalid"></mss-button>
    </div>
  </form>
</mss-modal-window>
